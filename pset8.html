<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>PSET8</title>
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <!-- D3 -->
    <script type="text/javascript" src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="style.css">

</head>

<body>
    <main class="container">
    	<div class = "row">
                <h1>Boston 311 Requests</h1><br>
            <!-- D3 visualization here -->
            <div id="bar-chart"></div>
            <!-- tooltip -->
            <div id="tooltip" class = 'hidden'>
                <p> Total 311 requests: <span id=name></span></p>
            </div>
            <!-- .on("mouseover", function(event, d) {})-->

    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Custom JS -->
    <script type="text/javascript">
    	const width = 1500;
    	const height = 600; 
    	const marginLeft = 300; 
    	const marginRight = 30;
    	const marginBottom = 30; 
        const marginTop = 30; 
        const tooltip =d3.select("#tooltip");

        const svg = d3.select("#bar-chart")
            .append("svg")
            .attr("viewBox", [0, 0, width, height + marginBottom]);


        function plotBarChart(data) {
            // create an array of only the xValues for the total_count
            //const newArray = dataArray.map(d => d.columnName);
            // get the x values from our data
            const xValues = data.map(d => d.total_count);
            // console.log(xValues);
            // create scale 
            const x = d3.scaleLinear()
                    .domain([0,d3.max(xValues)])
                    .range([0,width]); 
            // console.log(x(40000));
            // add scales to axis 
            const xAxis = d3.axisTop(x)
                    .ticks(6)
                    // 6 ticks for every 100 requests 
            // create x-axis 
            const chartGroup = svg.append("g")
                .attr("class", "axis x")
                .attr("transform", "translate(" + marginLeft + "," + marginTop + ")")
                .call(xAxis)
      
            // create an array of only the yValues for the total_count
            //const newArray = dataArray.map(d => d.columnName);
            // get the y values from our data
            const yValues = data.map(d => d.Name);
            // create scale 
            const y = d3.scaleBand()
                 .domain(yValues) 
                 .range([height, 0])
                 .paddingInner(0.15);
            // add scales to axis 
            const yAxis = d3.axisLeft(y)
            // create y axis
            const chartGrouptwo = svg.append("g")
                .attr("class", "axis y")
                .attr("transform", "translate(" + marginLeft + "," + marginTop  + ")")
                .call(yAxis)
            // style the text size of all the ticks in CSS to have the font-size of 14px
            // g.tick text {
            //     font-size: 14px;
            //     display: none
            // }

            // create rectangle elements 
            svg.selectAll("rect")
                .data(data)
                .enter()
                .append("rect")
                    .attr("height", y.bandwidth())
                    .attr("width", d => x(d.total_count))
                    .attr("fill", 'teal')
                    .attr("x", marginLeft)
                    .attr("y", d => y(d.Name) + marginTop)
                .on("mouseover", function(event, d) {
                    tooltip.classed('hidden',false)
                        .style("left",event.pageX +10 +"px")
                        .style("left", event.pageX + 10 + "px")
                        .style("top", event.pageY + 10 + "px")
                        .select("#name")
                            .html(d.total_count)
                })
                .on("mousemove", function(event) {
                    d3.select("#tooltip")          
                })
                .on("mouseout", function() {
                    tooltip.classed("hidden", true)
                });

        };

        // load csv data
        d3.csv("./boston_311.csv", d3.autoType)
            .then(function(data) {
                console.log(data);

                plotBarChart(data);
            })


    </script>
</body>
</html>